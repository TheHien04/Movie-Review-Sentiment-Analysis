<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Compare Reviews | Movie Sentiment Analysis</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="shared.css">
  <link rel="stylesheet" href="batch.css">
  <link rel="stylesheet" href="theme.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800&display=swap" rel="stylesheet">
  <style>
    .compare-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-top: 20px;
    }
    
    .compare-side {
      background: var(--bg-card);
      border: 2px solid var(--border-color);
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 6px var(--shadow-color);
    }
    
    .compare-header {
      font-size: 1.25rem;
      font-weight: bold;
      margin-bottom: 15px;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .review-label {
      background: var(--purple-gradient);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9rem;
    }
    
    .result-comparison {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-top: 30px;
    }
    
    .comparison-chart {
      background: var(--bg-card);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
    }
    
    @media (max-width: 768px) {
      .compare-container,
      .result-comparison {
        grid-template-columns: 1fr;
      }
    }
    
    .skip-link {
      position: absolute;
      left: -9999px;
      z-index: 999;
      padding: 1em;
      background-color: #000;
      color: white;
      text-decoration: none;
    }
    .skip-link:focus {
      left: 50%;
      transform: translateX(-50%);
      top: 10px;
    }
  </style>
</head>
<body class="main-bg">
  <a href="#main-content" class="skip-link">Skip to main content</a>
  
  <!-- Navigation Bar -->
  <nav class="navbar-custom" role="navigation" aria-label="Main navigation">
    <div class="navbar-content">
      <a href="index.html" class="navbar-logo">
        <span>üé¨</span>
        <span>Movie Sentiment AI</span>
      </a>
      <ul class="navbar-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="batch.html">Sentiment Analysis</a></li>
        <li><a href="compare.html" class="active">Compare</a></li>
        <li><a href="evaluation.html">Evaluation</a></li>
        <li><a href="dataset.html">Dataset</a></li>
      </ul>
    </div>
  </nav>

  <header class="header-gradient" role="banner">
    <h1 class="fw-bold display-5 text-white mb-1">
      <span class="me-2" aria-hidden="true">‚öñÔ∏è</span>Compare Reviews
    </h1>
  </header>

  <main id="main-content" role="main">
    <div class="container d-flex justify-content-center">
      <div class="main-card card shadow-lg p-4" style="max-width: 1200px; width:100%; border-radius: 1.5rem;">
        <h2 class="fw-bold mb-3 text-center" style="font-family: 'Montserrat', Arial, sans-serif; font-size: 1.75rem;">‚öñÔ∏è Compare Reviews Side-by-Side</h2>
        <p class="text-center mb-4" style="color: var(--text-secondary); font-size: 0.95rem;">Analyze and compare two movie reviews simultaneously</p>
          
          <!-- Input Section -->
          <div class="compare-container">
            <!-- Review A -->
            <div class="compare-side">
              <div class="compare-header">
                <span class="review-label">Review A</span>
              </div>
              <textarea 
                id="review-a" 
                class="form-control mb-3" 
                rows="6" 
                placeholder="Enter first movie review here..."
                aria-label="First review input"
              ></textarea>
              <button 
                id="analyze-a-btn" 
                class="btn btn-animated btn-lg w-100"
              >
                üéØ Analyze Review A
              </button>
              <div id="result-a" class="mt-3"></div>
            </div>

            <!-- Review B -->
            <div class="compare-side">
              <div class="compare-header">
                <span class="review-label">Review B</span>
              </div>
              <textarea 
                id="review-b" 
                class="form-control mb-3" 
                rows="6" 
                placeholder="Enter second movie review here..."
                aria-label="Second review input"
              ></textarea>
              <button 
                id="analyze-b-btn" 
                class="btn btn-animated btn-lg w-100"
              >
                üéØ Analyze Review B
              </button>
              <div id="result-b" class="mt-3"></div>
            </div>
          </div>

          <!-- Quick Actions -->
          <div class="text-center mt-4">
            <button id="analyze-both-btn" class="btn btn-danger btn-lg shadow btn-animated me-2">
              ‚ö° Analyze Both
            </button>
            <button id="clear-all-btn" class="btn btn-soft btn-lg shadow me-2">
              üóëÔ∏è Clear All
            </button>
            <button id="swap-btn" class="btn btn-soft btn-lg shadow">
              üîÑ Swap Reviews
            </button>
          </div>

          <!-- Comparison Chart -->
          <div id="comparison-section" style="display: none;">
            <hr class="my-4">
            <h3 class="text-center mb-4">üìä Comparison Analysis</h3>
            <div class="result-comparison">
              <div class="comparison-chart">
                <h5>Sentiment Distribution</h5>
                <canvas id="sentiment-comparison-chart" width="300" height="250"></canvas>
              </div>
              <div class="comparison-chart">
                <h5>Confidence Levels</h5>
                <canvas id="confidence-comparison-chart" width="300" height="250"></canvas>
              </div>
            </div>
            
            <!-- Winner Card -->
            <div id="winner-card" class="text-center mt-4 p-4" style="background: var(--bg-secondary); border-radius: 12px;">
              <h4>üì£ Comparison Summary</h4>
              <p id="winner-text" class="lead mb-0"></p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer class="py-3 text-center footer-gradient text-white-50 mt-4">
    <small>¬© 2025 Movie Sentiment AI | For Statistical Machine Learning Project</small>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="theme.js"></script>
  <script src="shared.js"></script>
  <script>
    // Compare Page Logic
    let resultA = null;
    let resultB = null;
    let sentimentChart = null;
    let confidenceChart = null;

    // Analyze individual review
    async function analyzeReview(reviewId, resultId) {
      const textarea = document.getElementById(reviewId);
      const resultDiv = document.getElementById(resultId);
      const review = textarea.value.trim();

      if (!review) {
        alert('Please enter a review first!');
        return null;
      }

      resultDiv.innerHTML = '<p class="text-muted">üîÑ Analyzing...</p>';

      try {
        const response = await fetch('http://localhost:8000/api/predict', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text: review })
        });

        const data = await response.json();
        displayResult(data, resultDiv);
        return data;
      } catch (error) {
        resultDiv.innerHTML = '<p class="text-danger">‚ùå Error analyzing review</p>';
        console.error(error);
        return null;
      }
    }

    // Display result with confidence gradient
    function displayResult(data, container) {
      const isPositive = data.label === 1;
      const icon = isPositive ? 'üòä' : 'üòû';
      const sentiment = isPositive ? 'Positive' : 'Negative';
      const confidence = (data.probability * 100).toFixed(1);
      const color = isPositive ? 'var(--purple-primary)' : 'var(--error-color)';

      container.innerHTML = `
        <div class="p-3 rounded" style="background: var(--bg-secondary); border-left: 4px solid ${color};">
          <h5 style="color: ${color};">${icon} ${sentiment}</h5>
          <p class="mb-1"><strong>Confidence:</strong> ${confidence}%</p>
          <div class="progress" style="height: 8px;">
            <div class="progress-bar" role="progressbar" style="width: ${confidence}%; background: ${color};" 
                 aria-valuenow="${confidence}" aria-valuemin="0" aria-valuemax="100"></div>
          </div>
        </div>
      `;
    }

    // Update comparison charts
    function updateComparison() {
      if (!resultA || !resultB) return;

      document.getElementById('comparison-section').style.display = 'block';

      // Sentiment comparison
      const sentimentCtx = document.getElementById('sentiment-comparison-chart').getContext('2d');
      if (sentimentChart) sentimentChart.destroy();
      
      sentimentChart = new Chart(sentimentCtx, {
        type: 'bar',
        data: {
          labels: ['Review A', 'Review B'],
          datasets: [{
            label: 'Positive Confidence',
            data: [
              resultA.label === 1 ? resultA.probability * 100 : (1 - resultA.probability) * 100,
              resultB.label === 1 ? resultB.probability * 100 : (1 - resultB.probability) * 100
            ],
            backgroundColor: ['rgba(123, 92, 255, 0.8)', 'rgba(99, 102, 241, 0.8)']
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: { beginAtZero: true, max: 100 }
          }
        }
      });

      // Confidence comparison
      const confidenceCtx = document.getElementById('confidence-comparison-chart').getContext('2d');
      if (confidenceChart) confidenceChart.destroy();
      
      confidenceChart = new Chart(confidenceCtx, {
        type: 'doughnut',
        data: {
          labels: ['Review A', 'Review B'],
          datasets: [{
            data: [resultA.probability * 100, resultB.probability * 100],
            backgroundColor: ['#7b5cff', '#6366f1']
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false
        }
      });

      // Winner determination
      const winnerText = document.getElementById('winner-text');
      const sentA = resultA.label === 1 ? 'Positive' : 'Negative';
      const sentB = resultB.label === 1 ? 'Positive' : 'Negative';
      
      if (resultA.label === resultB.label) {
        const stronger = resultA.probability > resultB.probability ? 'A' : 'B';
        winnerText.innerHTML = `Both reviews are <strong>${sentA}</strong>, but Review <strong>${stronger}</strong> shows stronger sentiment.`;
      } else {
        winnerText.innerHTML = `Reviews have <strong>opposite sentiments</strong>: Review A is <strong>${sentA}</strong> while Review B is <strong>${sentB}</strong>.`;
      }
    }

    // Event Listeners
    document.getElementById('analyze-a-btn').addEventListener('click', async () => {
      resultA = await analyzeReview('review-a', 'result-a');
      if (resultA && resultB) updateComparison();
    });

    document.getElementById('analyze-b-btn').addEventListener('click', async () => {
      resultB = await analyzeReview('review-b', 'result-b');
      if (resultA && resultB) updateComparison();
    });

    document.getElementById('analyze-both-btn').addEventListener('click', async () => {
      resultA = await analyzeReview('review-a', 'result-a');
      resultB = await analyzeReview('review-b', 'result-b');
      if (resultA && resultB) {
        setTimeout(updateComparison, 300);
      }
    });

    document.getElementById('clear-all-btn').addEventListener('click', () => {
      document.getElementById('review-a').value = '';
      document.getElementById('review-b').value = '';
      document.getElementById('result-a').innerHTML = '';
      document.getElementById('result-b').innerHTML = '';
      document.getElementById('comparison-section').style.display = 'none';
      resultA = null;
      resultB = null;
    });

    document.getElementById('swap-btn').addEventListener('click', () => {
      const tempText = document.getElementById('review-a').value;
      document.getElementById('review-a').value = document.getElementById('review-b').value;
      document.getElementById('review-b').value = tempText;
      
      const tempResult = resultA;
      resultA = resultB;
      resultB = tempResult;
      
      if (resultA) displayResult(resultA, document.getElementById('result-a'));
      else document.getElementById('result-a').innerHTML = '';
      
      if (resultB) displayResult(resultB, document.getElementById('result-b'));
      else document.getElementById('result-b').innerHTML = '';
      
      if (resultA && resultB) updateComparison();
    });

    // Keyboard shortcuts for compare page
    if (window.keyboardShortcuts) {
      keyboardShortcuts.register('analyze', () => {
        document.getElementById('analyze-both-btn').click();
      });
      
      keyboardShortcuts.register('clear', () => {
        document.getElementById('clear-all-btn').click();
      });
    }
  </script>
</body>
</html>
