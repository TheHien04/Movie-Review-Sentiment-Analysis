<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Movie Sentiment Analysis - Dataset Overview"/>
  <meta name="theme-color" content="#6366f1"/>
  <title>Dataset Overview | Movie Sentiment Analysis</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="dataset.css"/>
  <link rel="stylesheet" href="shared.css"/>
  <link rel="stylesheet" href="theme.css"/>
  <link rel="stylesheet" href="premium-effects.css"/>
  <style>
    .skip-link {
      position: absolute;
      left: -9999px;
      z-index: 999;
      padding: 1em;
      background-color: #000;
      color: white;
      text-decoration: none;
    }
    .skip-link:focus {
      left: 50%;
      transform: translateX(-50%);
      top: 10px;
    }
  </style>
</head>
<body class="main-bg" style="font-family: 'Montserrat', Arial, sans-serif;">
  <a href="#main-content" class="skip-link">Skip to main content</a>
  <!-- Navigation Bar -->
  <nav class="navbar-custom" role="navigation" aria-label="Main navigation">
    <div class="navbar-content">
      <a href="index.html" class="navbar-logo">
        <span>üé¨</span>
        <span>Movie Sentiment AI</span>
      </a>
      <ul class="navbar-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="batch.html">Sentiment Analysis</a></li>
        <li><a href="compare.html">Compare</a></li>
        <li><a href="evaluation.html">Evaluation</a></li>
        <li><a href="dataset.html" class="active">Dataset</a></li>
      </ul>
    </div>
  </nav>

  <header class="header-gradient" role="banner">
    <h1 class="fw-bold display-5 text-white mb-1">
      <span class="me-2" aria-hidden="true">üìö</span>Dataset Overview
    </h1>
    <p class="lead text-white mb-0" style="font-size: 1rem; margin-top: 4px; opacity: 0.85;">Key statistics about the movie review dataset</p>
  </header>

  <main id="main-content" role="main">
    <section class="card dataset-stats-section">
      <h2>Dataset Statistics</h2>
      <div class="section-desc">Key statistics about the movie review dataset.</div>
      <div id="dataset-stats" style="min-height: 120px;">
        <div style="font-size:1.05rem; margin-bottom:6px;">
          <span title="Trung b√¨nh s·ªë k√Ω t·ª± m·ªói review">‚è≥ Loading statistical data...</span>
        </div>
      </div>
    </section>

    <!-- Label Distribution Section -->
    <section class="card">
      <h2>üìä Label Distribution</h2>
      <div class="section-desc">Distribution of positive and negative reviews in the dataset.</div>
      <div style="padding: 20px;">
        <canvas id="label-chart" width="400" height="250" style="max-width:100%; height:250px; margin:0 auto; display:block;"></canvas>
      </div>
    </section>

    <section class="card sample-section">
      <h2>Sample Data</h2>
      <div class="section-desc">Browse and search sample reviews from the dataset.</div>
      
      <!-- Export Button -->
      <div style="margin-bottom: 1rem;">
        <button onclick="exportDatasetCSV()" class="btn-animated" style="padding: 0.5rem 1.5rem; font-size: 0.9rem;">
          üì• Export CSV
        </button>
        <button onclick="exportDatasetJSON()" class="btn-animated" style="padding: 0.5rem 1.5rem; font-size: 0.9rem; margin-left: 0.5rem;">
          üì• Export JSON
        </button>
      </div>

      <div class="sample-controls">
        <input id="sample-search" type="search" placeholder="Search text‚Ä¶" class="sample-search">
        <div class="badge" id="sample-count">0 items</div>
      </div>

      <div id="pager" class="pager">
        <button id="prev-page" class="btn-soft" type="button" disabled>Prev</button>
        <span id="page-info" class="badge">1/1</span>
        <button id="next-page" class="btn-soft" type="button" disabled>Next</button>
        <div class="pager-right">
          <label for="per-page" class="badge">Rows per page</label>
          <select id="per-page" class="badge">
            <option value="3">3</option>
            <option value="5" selected>5</option>
            <option value="10">10</option>
            <option value="20">20</option>
            <option value="50">50</option>
          </select>
          <a class="btn-soft" href="/api/sample.csv" download>Download sample CSV</a>
        </div>
      </div>

      <div class="table-wrap">
        <table id="sample-table">
          <thead>
            <tr><th>Review</th><th>Label</th></tr>
          </thead>
          <tbody><!-- filled by JS --></tbody>
        </table>
      </div>
    </section>
  </main>

  <footer class="py-3 text-center footer-gradient text-white-50 mt-4">
    <small>&copy; 2025 Movie Sentiment AI | For Statistical Machine Learning Project</small>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="theme.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="shared.js"></script>
  <script>
    // Inline dataset loader - ensures data loads regardless of main.js cache issues
    (function() {
      const API_URL = 'http://localhost:8000/api/dataset-info';
      const statsEl = document.getElementById('dataset-stats');
      const tableBody = document.querySelector('#sample-table tbody');
      const labelCanvas = document.getElementById('label-chart');
      let labelChartInstance = null;

      function loadDataset() {
        console.log('[Dataset] Fetching from:', API_URL);
        statsEl.innerHTML = '<span style="color:#aaa;">‚è≥ ƒêang t·∫£i d·ªØ li·ªáu...</span>';

        fetch(API_URL)
          .then(response => {
            console.log('[Dataset] Response:', response.status);
            if (!response.ok) throw new Error('HTTP ' + response.status);
            return response.json();
          })
          .then(data => {
            console.log('[Dataset] Data loaded:', data);
            
            // Render stats
            if (data.stats) {
              let html = '';
              for (const [key, value] of Object.entries(data.stats)) {
                const formattedValue = typeof value === 'number' ? value.toLocaleString() : value;
                html += '<div style="font-size:1.05rem; margin-bottom:6px;"><strong>' + key + ':</strong> ' + formattedValue + '</div>';
              }
              statsEl.innerHTML = html;
            }

            // Render sample table
            if (data.samples && tableBody) {
              tableBody.innerHTML = data.samples.map(row => 
                '<tr><td>' + row.text.substring(0, 200) + (row.text.length > 200 ? '...' : '') + '</td><td>' + (row.label === 1 ? 'Positive' : 'Negative') + '</td></tr>'
              ).join('');
            }

            // Render label distribution pie chart
            if (data.stats && labelCanvas && typeof Chart !== 'undefined') {
              const neg = data.stats.Negative || 0;
              const pos = data.stats.Positive || 0;
              
              if (labelChartInstance) labelChartInstance.destroy();
              
              labelChartInstance = new Chart(labelCanvas.getContext('2d'), {
                type: 'pie',
                data: {
                  labels: ['Negative', 'Positive'],
                  datasets: [{
                    data: [neg, pos],
                    backgroundColor: ['#ff6b6b', '#7b5cff'],
                    borderWidth: 2,
                    borderColor: '#fff'
                  }]
                },
                options: {
                  responsive: true,
                  maintainAspectRatio: false,
                  plugins: {
                    legend: { 
                      position: 'bottom',
                      labels: {
                        font: { size: 14, weight: 'bold' },
                        padding: 15
                      }
                    },
                    tooltip: {
                      callbacks: {
                        label: function(context) {
                          const total = neg + pos || 1;
                          const pct = ((context.raw / total) * 100).toFixed(1);
                          return context.label + ': ' + context.raw.toLocaleString() + ' (' + pct + '%)';
                        }
                      }
                    }
                  }
                }
              });
            }
          })
          .catch(err => {
            console.error('[Dataset] Error:', err);
            statsEl.innerHTML = '<div style="color:#ff6b6b; padding:15px; background:rgba(255,107,107,0.1); border-radius:8px;">' +
              '<strong>‚ùå Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu</strong><br><br>' +
              '<strong>L·ªói:</strong> ' + err.message + '<br><br>' +
              '<strong>H∆∞·ªõng d·∫´n fix:</strong><br>' +
              '1. Ki·ªÉm tra Backend c√≥ ch·∫°y (port 8000)<br>' +
              '2. M·ªü: <a href="http://localhost:8000/api/dataset-info" target="_blank" style="color:#7b5cff;">http://localhost:8000/api/dataset-info</a><br>' +
              '3. Hard refresh: <kbd>Cmd+Shift+R</kbd> (Mac) ho·∫∑c <kbd>Ctrl+Shift+R</kbd> (Windows)' +
              '</div>';
          });
      }

      // Load on DOMContentLoaded
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', loadDataset);
      } else {
        loadDataset();
      }
    })();
  </script>
</body>
</html>
